<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides customizable 3D tree models (as OBJ files) for use in data visualization. Includes both planar and solid tree models, various crown types (columnar, oval, palm, pyramidal, rounded, spreading, vase, weeping), and options to change the diameter, height, and color of the tree's crown and trunk.  ">
<title>3D Tree Models • tree3d</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="3D Tree Models">
<meta property="og:description" content="Provides customizable 3D tree models (as OBJ files) for use in data visualization. Includes both planar and solid tree models, various crown types (columnar, oval, palm, pyramidal, rounded, spreading, vase, weeping), and options to change the diameter, height, and color of the tree's crown and trunk.  ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">tree3d</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tylermorganwall/tree3d/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="tree3d-3d-tree-models-">tree3d: 3D Tree Models <img src="reference/figures/tree3d_hexlogo_small.png" align="right"><a class="anchor" aria-label="anchor" href="#tree3d-3d-tree-models-"></a>
</h1></div>
<p><code>tree3d</code> is an R package that provides highly customizable 3D tree models for data visualization and 3D scene creation. <code>tree3d</code> allows you to generate tree models as OBJ files, which can then easily be integrated into your data visualization, animation, or 3D rendering workflows.</p>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li><p><strong>Variety of tree models</strong>: Includes both planar and solid tree models.</p></li>
<li><p><strong>Multiple crown types</strong>: Provides a wide range of crown types, including: columnar, oval, palm, pyramidal, rounded, spreading, vase, and weeping. Each type offers a unique visual aesthetic to represent different types of trees.</p></li>
<li><p><strong>Customizable dimensions and color</strong>: Allows you to adjust the diameter, height, and color of both the tree’s crown and trunk individually. This flexibility allows you to customize the tree model for your specific use case.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><code>tree3d</code> can currently be installed from Github.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"tylermorganwall/tree3d"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>Let’s load the sandbox data included in the Github repository. We will then unzip the file, and then load the shapefiles into R using {sf}.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tylermorganwall.github.io/tree3d/" class="external-link">tree3d</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.18</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rayshader.com" class="external-link">rayshader</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the sample data</span></span>
<span><span class="va">temp_download</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".zip"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://github.com/tylermorganwall/tree3d/raw/main/inst/extdata/tree3d_sandbox_data.zip"</span>, <span class="va">temp_download</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Unzip and get directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="va">temp_download</span>, exdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">zipdir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">.Platform</span><span class="op">$</span><span class="va">file.sep</span>, </span>
<span>                <span class="st">"sandbox_data"</span>, <span class="va">.Platform</span><span class="op">$</span><span class="va">file.sep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load all files</span></span>
<span><span class="va">poly_boundary</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">zipdir</span>, <span class="st">"Area_Boundary_subset.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">baseline_tree</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">zipdir</span>, <span class="st">"Baseline_Trees_Z_clip.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">building_baseline</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">zipdir</span>, <span class="st">"Buildings_Baseline_2020_Z_clip.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">parcels</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_read</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">zipdir</span>, <span class="st">"Parcels_2020_clip.shp"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dem</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu">rast</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">zipdir</span>, <span class="st">"DEM_2013_subset_zero.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the tree data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">baseline_tree</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XYZ</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 493801.7 ymin: 5452079 xmax: 493951.7 ymax: 5452181</span></span>
<span><span class="co">#&gt; z_range:       zmin: 7.19 zmax: 16.25</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / UTM zone 10N</span></span>
<span><span class="co">#&gt;             Species Height      Type Location MatureSize Diameter  CrownType</span></span>
<span><span class="co">#&gt; 1 Prunus cerasifera   7.19 Deciduous   Street      Small      4.6 spreading1</span></span>
<span><span class="co">#&gt; 2  Acer x freemanii  16.25 Deciduous   Street      Large     12.1       oval</span></span>
<span><span class="co">#&gt; 3  Acer x freemanii  16.22 Deciduous   Street      Large      7.5       oval</span></span>
<span><span class="co">#&gt; 4    Fraxinus ornus   8.09 Deciduous   Street     Medium      4.1       oval</span></span>
<span><span class="co">#&gt; 5  Parrotia persica   9.20 Deciduous   Street     Medium      4.1 spreading1</span></span>
<span><span class="co">#&gt; 6       Sorbus aria   9.67 Deciduous   Street     Medium      5.3       oval</span></span>
<span><span class="co">#&gt;   Color                       geometry</span></span>
<span><span class="co">#&gt; 1  &lt;NA&gt; POINT Z (493937.4 5452179 7...</span></span>
<span><span class="co">#&gt; 2  &lt;NA&gt; POINT Z (493951.7 5452079 1...</span></span>
<span><span class="co">#&gt; 3  &lt;NA&gt; POINT Z (493831.7 5452181 1...</span></span>
<span><span class="co">#&gt; 4  &lt;NA&gt; POINT Z (493801.7 5452167 8...</span></span>
<span><span class="co">#&gt; 5  &lt;NA&gt; POINT Z (493845.4 5452181 9.2)</span></span>
<span><span class="co">#&gt; 6  &lt;NA&gt; POINT Z (493898.5 5452165 9...</span></span></code></pre></div>
<p>Now that our data is loaded, let’s generate a 3D map with rayshader. We will load in our</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Use rayshader to convert the DEM to a matrix and generate a 3D mesh</span></span>
<span><span class="va">dem_mat</span> <span class="op">=</span> <span class="fu">raster_to_matrix</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="va">dem_mat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">constant_shade</span><span class="op">(</span><span class="st">"#6dbd83"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_overlay</span><span class="op">(</span><span class="fu">generate_polygon_overlay</span><span class="op">(</span><span class="va">poly_boundary</span>, extent <span class="op">=</span> <span class="fu">ext</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>,</span>
<span>                                       heightmap <span class="op">=</span> <span class="va">dem_mat</span>,</span>
<span>                                       palette <span class="op">=</span> <span class="st">"#bcebc9"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_overlay</span><span class="op">(</span><span class="fu">generate_polygon_overlay</span><span class="op">(</span><span class="va">parcels</span>, extent <span class="op">=</span> <span class="fu">ext</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>,</span>
<span>                                       heightmap <span class="op">=</span> <span class="va">dem_mat</span>,</span>
<span>                                       palette <span class="op">=</span> <span class="st">"#afe0bd"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_3d</span><span class="op">(</span><span class="va">dem_mat</span>, background <span class="op">=</span> <span class="st">"lightblue"</span>, windowsize <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Render the buildings as extruded polygons</span></span>
<span><span class="fu">render_polygons</span><span class="op">(</span><span class="va">building_baseline</span>, </span>
<span>                extent <span class="op">=</span> <span class="fu">ext</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>, </span>
<span>                data_column_top <span class="op">=</span> <span class="st">"height_ag"</span>, </span>
<span>                clear_previous <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                color <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>                heightmap <span class="op">=</span> <span class="va">dem_mat</span><span class="op">)</span></span>
<span><span class="fu">render_camera</span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">44</span>, phi <span class="op">=</span> <span class="fl">36</span>, zoom <span class="op">=</span> <span class="fl">0.7</span>, fov <span class="op">=</span> <span class="fl">50</span>, shift_vertical <span class="op">=</span> <span class="op">-</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu">render_snapshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="100%"></p>
<p>Now that we have our 3D map generated, let’s add our custom trees using rayshader’s <code>render_trees()</code> function. <code>tree3d</code> provides <code><a href="reference/get_crown_file.html">get_crown_file()</a></code> and <code><a href="reference/get_trunk_file.html">get_trunk_file()</a></code>, which allows access to the separate 3D models included in the package. Passing in each model separately gives you full control over the size, shape, and colors of the trees.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Render the trees, using data from `baseline_tree` to draw each tree individually</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">baseline_tree</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">single_tree_info</span> <span class="op">=</span> <span class="va">baseline_tree</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">tree_defaults</span> <span class="op">=</span> <span class="fu"><a href="reference/get_tree_data.html">get_tree_data</a></span><span class="op">(</span><span class="va">single_tree_info</span><span class="op">$</span><span class="va">CrownType</span><span class="op">)</span></span>
<span>  <span class="va">latlongheight</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">single_tree_info</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu">render_tree</span><span class="op">(</span>long <span class="op">=</span> <span class="va">latlongheight</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lat <span class="op">=</span> <span class="va">latlongheight</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>              extent <span class="op">=</span> <span class="fu">ext</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>, heightmap <span class="op">=</span> <span class="va">dem_mat</span>, </span>
<span>              tree_height <span class="op">=</span> <span class="va">single_tree_info</span><span class="op">$</span><span class="va">Height</span>,</span>
<span>              crown_width <span class="op">=</span> <span class="va">single_tree_info</span><span class="op">$</span><span class="va">Diameter</span>,</span>
<span>              trunk_height_ratio <span class="op">=</span> <span class="va">tree_defaults</span><span class="op">$</span><span class="va">trunk_crown_ratio</span>,</span>
<span>              custom_obj_crown <span class="op">=</span> <span class="fu"><a href="reference/get_crown_file.html">get_crown_file</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">single_tree_info</span><span class="op">$</span><span class="va">CrownType</span><span class="op">)</span>,</span>
<span>              custom_obj_trunk <span class="op">=</span> <span class="fu"><a href="reference/get_trunk_file.html">get_trunk_file</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">render_camera</span><span class="op">(</span><span class="fl">40</span>, <span class="fl">23</span>,  <span class="fl">0.25</span>, <span class="fl">90</span><span class="op">)</span></span>
<span><span class="fu">render_snapshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<p>We can also generate high quality renders with our trees using rayshader:. Here, we use the solid models.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">render_tree</span><span class="op">(</span>clear_previous <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">baseline_tree</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">single_tree_info</span> <span class="op">=</span> <span class="va">baseline_tree</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">tree_defaults</span> <span class="op">=</span> <span class="fu"><a href="reference/get_tree_data.html">get_tree_data</a></span><span class="op">(</span><span class="va">single_tree_info</span><span class="op">$</span><span class="va">CrownType</span><span class="op">)</span></span>
<span>  <span class="va">latlongheight</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">st_geometry</span><span class="op">(</span><span class="va">single_tree_info</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu">render_tree</span><span class="op">(</span>long <span class="op">=</span> <span class="va">latlongheight</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lat <span class="op">=</span> <span class="va">latlongheight</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>              extent <span class="op">=</span> <span class="fu">ext</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span>, heightmap <span class="op">=</span> <span class="va">dem_mat</span>, </span>
<span>              tree_height <span class="op">=</span> <span class="va">single_tree_info</span><span class="op">$</span><span class="va">Height</span>,</span>
<span>              crown_width <span class="op">=</span> <span class="va">single_tree_info</span><span class="op">$</span><span class="va">Diameter</span>,</span>
<span>              trunk_height_ratio <span class="op">=</span> <span class="va">tree_defaults</span><span class="op">$</span><span class="va">trunk_crown_ratio</span>,</span>
<span>              custom_obj_crown <span class="op">=</span> <span class="fu"><a href="reference/get_crown_file.html">get_crown_file</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="va">single_tree_info</span><span class="op">$</span><span class="va">CrownType</span>,</span>
<span>                                                solid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              custom_obj_trunk <span class="op">=</span> <span class="fu"><a href="reference/get_trunk_file.html">get_trunk_file</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">render_camera</span><span class="op">(</span><span class="fl">40</span>, <span class="fl">23</span>,  <span class="fl">0.10</span>, <span class="fl">90</span><span class="op">)</span></span>
<span><span class="fu">render_snapshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-hq-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">render_highquality</span><span class="op">(</span>min_variance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   sample_method <span class="op">=</span> <span class="st">"sobol"</span>,</span>
<span>                   samples <span class="op">=</span> <span class="fl">2048</span>, </span>
<span>                   lightaltitude <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                   lightdirection <span class="op">=</span> <span class="fl">45</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-hq-2.png" width="100%"></p>
<p>We can also extract 3D tree information from lidar data using the lidR package and use that data to generate 3D trees. Here, we’ll use random trees from the package to fill in our scene.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lidar/lidR" class="external-link">lidR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#We will use the lidR package to generate a DEM and detect the crown tops of trees, and</span></span>
<span><span class="co">#then use rayshader to render 3D tree models scaled to those heights on the map.</span></span>
<span><span class="co">#Load the example data from the lidR package</span></span>
<span><span class="va">LASfile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Topography.laz"</span>, package<span class="op">=</span><span class="st">"lidR"</span><span class="op">)</span></span>
<span><span class="va">las</span> <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu">readLAS</span><span class="op">(</span><span class="va">LASfile</span>, filter <span class="op">=</span> <span class="st">"-inside 273450 5274350 273550 5274450"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Convert the lidar point data to a DEM and detect the location of trees from the same data</span></span>
<span><span class="va">dem</span> <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu">rasterize_terrain</span><span class="op">(</span><span class="va">las</span>, algorithm <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu">tin</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tree_top_data</span> <span class="op">=</span> <span class="fu">lidR</span><span class="fu">::</span><span class="fu">locate_trees</span><span class="op">(</span><span class="va">las</span>, <span class="fu">lidR</span><span class="fu">::</span><span class="fu">lmf</span><span class="op">(</span>ws <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tree_locations</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_coordinates</span><span class="op">(</span><span class="va">tree_top_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Convert DEM to a matrix and extract the extent of the scene</span></span>
<span><span class="va">dem_matrix</span> <span class="op">=</span> <span class="fu">raster_to_matrix</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="va">dem_extent</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu">ext</span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="va">extent_values</span> <span class="op">=</span> <span class="va">dem_extent</span><span class="op">@</span><span class="va">ptr</span><span class="op">$</span><span class="va">vector</span></span>
<span></span>
<span><span class="co">#Plot the ground</span></span>
<span><span class="va">dem_matrix</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">height_shade</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_shadow</span><span class="op">(</span><span class="fu">texture_shade</span><span class="op">(</span><span class="va">dem_matrix</span><span class="op">)</span>,<span class="fl">0.2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_shadow</span><span class="op">(</span><span class="fu">lamb_shade</span><span class="op">(</span><span class="va">dem_matrix</span><span class="op">)</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_3d</span><span class="op">(</span><span class="va">dem_matrix</span>, windowsize <span class="op">=</span> <span class="fl">800</span>, zscale <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">render_snapshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-lidar-1.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Get tree data</span></span>
<span><span class="va">tree_df</span> <span class="op">=</span> <span class="fu">tree3d</span><span class="fu">::</span><span class="fu"><a href="reference/get_tree_data.html">get_tree_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tree_df</span></span>
<span><span class="co">#&gt;          name solid_available trunk_color tree_color trunk_crown_ratio</span></span>
<span><span class="co">#&gt; 1    columnar            TRUE     #8C6F5B    #A2C683         0.3333333</span></span>
<span><span class="co">#&gt; 2  pyramidal1            TRUE     #8C6F5B    #066038         0.1666667</span></span>
<span><span class="co">#&gt; 3  pyramidal2            TRUE     #8C6F5B    #447765         0.1666667</span></span>
<span><span class="co">#&gt; 4        oval            TRUE     #8C6F5B    #CBD362         0.3333333</span></span>
<span><span class="co">#&gt; 5        palm           FALSE     #8C6F5B    #CCB471         0.5000000</span></span>
<span><span class="co">#&gt; 6     rounded           FALSE     #8C6F5B    #7CB262         0.3333333</span></span>
<span><span class="co">#&gt; 7  spreading1            TRUE     #8C6F5B    #DB8952         0.3333333</span></span>
<span><span class="co">#&gt; 8  spreading2           FALSE     #8C6F5B    #E0A854         0.3333333</span></span>
<span><span class="co">#&gt; 9        vase           FALSE     #8C6F5B    #75C165         0.3333333</span></span>
<span><span class="co">#&gt; 10    weeping            TRUE     #8C6F5B    #AECCB1         0.3333333</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">random_trees</span> <span class="op">=</span> <span class="va">tree_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tree_locations</span><span class="op">)</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">random_trees</span><span class="op">$</span><span class="va">solid_available</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">random_trees</span><span class="op">$</span><span class="va">solid_available</span>, </span>
<span>                                      <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                                      <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">random_trees</span><span class="op">)</span></span>
<span><span class="co">#&gt;           name solid_available trunk_color tree_color trunk_crown_ratio</span></span>
<span><span class="co">#&gt; 9         vase           FALSE     #8C6F5B    #75C165         0.3333333</span></span>
<span><span class="co">#&gt; 4         oval            TRUE     #8C6F5B    #CBD362         0.3333333</span></span>
<span><span class="co">#&gt; 7   spreading1            TRUE     #8C6F5B    #DB8952         0.3333333</span></span>
<span><span class="co">#&gt; 1     columnar            TRUE     #8C6F5B    #A2C683         0.3333333</span></span>
<span><span class="co">#&gt; 2   pyramidal1            TRUE     #8C6F5B    #066038         0.1666667</span></span>
<span><span class="co">#&gt; 7.1 spreading1            TRUE     #8C6F5B    #DB8952         0.3333333</span></span>
<span></span>
<span><span class="fu">render_camera</span><span class="op">(</span>theta<span class="op">=</span><span class="fl">45</span>,phi<span class="op">=</span><span class="fl">30</span>,zoom<span class="op">=</span><span class="fl">0.3</span>,fov<span class="op">=</span><span class="fl">90</span>, shift_vertical <span class="op">=</span> <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tree_locations</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">trunk_ratio_single</span> <span class="op">=</span> <span class="va">tree_df</span><span class="op">$</span><span class="va">trunk_crown_ratio</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tree_df</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="va">random_trees</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu">render_tree</span><span class="op">(</span>lat <span class="op">=</span> <span class="va">tree_locations</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span>, long <span class="op">=</span> <span class="va">tree_locations</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>              custom_obj_crown <span class="op">=</span> <span class="fu"><a href="reference/get_crown_file.html">get_crown_file</a></span><span class="op">(</span><span class="va">random_trees</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span>, resolution <span class="op">=</span> <span class="st">"high"</span>,</span>
<span>                                                solid <span class="op">=</span> <span class="va">random_trees</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              custom_obj_trunk <span class="op">=</span> <span class="fu"><a href="reference/get_trunk_file.html">get_trunk_file</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>              absolute_height <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              tree_height <span class="op">=</span> <span class="va">tree_locations</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span>,</span>
<span>              trunk_height_ratio <span class="op">=</span> <span class="va">trunk_ratio_single</span>,</span>
<span>              crown_width_ratio <span class="op">=</span> <span class="fl">0.75</span> <span class="op">+</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>              crown_color <span class="op">=</span> <span class="va">random_trees</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span>,</span>
<span>              angle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">360</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>              extent <span class="op">=</span> <span class="va">dem</span>, </span>
<span>              zscale <span class="op">=</span> <span class="fl">2</span>, </span>
<span>              heightmap <span class="op">=</span> <span class="va">dem_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">render_snapshot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-lidar-2.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>We would like to acknowledge the following people/organizations for their contributions to the package:</p>
<p>elementslab (in the University of British Columbia) for supporting the development of the 3D tree models</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=tree3d" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/tylermorganwall/tree3d/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/tylermorganwall/tree3d/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing tree3d</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Tyler Morgan-Wall <br><small class="roles"> Author, copyright holder, maintainer </small> <a href="https://orcid.org/0000-0002-3131-3814" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Samantha Miller <br><small class="roles"> Author, copyright holder </small> <a href="https://orcid.org/0009-0001-1859-7146" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Agatha Czekajlo <br><small class="roles"> Author, copyright holder </small> <a href="https://orcid.org/0000-0001-7266-8286" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/tylermorganwall/tree3d/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/tylermorganwall/tree3d/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tyler Morgan-Wall, Samantha Miller, Agatha Czekajlo.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
